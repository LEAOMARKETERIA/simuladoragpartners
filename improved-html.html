<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Comissão Otimizado</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    
    :root {
      --primary-color: #00A8C5;
      --primary-hover: #007A9B;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --text-color: #003b5c;
      --text-light: #5a7d95;
      --border-color: #ccd6dd;
      --bg-result: #f0f9ff;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Inter', sans-serif;
      background: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      width: 100%;
      color: var(--text-color);
    }
    
    .calc-wrapper {
      width: 100%;
      max-width: 540px;
    }
    
    .calc-form {
      width: 100%;
      border: none;
      box-shadow: none;
      background: transparent;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .form-group {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .calc-form label {
      font-weight: 600;
      font-size: 14px;
    }
    
    .input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
    }

    .input-icon {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-light);
        pointer-events: none;
        display: flex;
        align-items: center;
    }

    .validation-icon {
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0;
        transition: opacity 0.2s ease;
    }

    .form-group.valid .validation-icon.success-icon { opacity: 1; }
    
    .calc-form input,
    .calc-form select {
      width: 100%;
      padding: 13px 40px 13px 42px;
      font-size: 15px;
      font-family: 'Inter', sans-serif;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background-color: #fff;
      transition: all 0.2s ease;
      color: var(--text-color);
    }
    
    .calc-form select {
        padding: 13px 40px 13px 14px; 
    }
    
    .calc-form input:focus,
    .calc-form select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 168, 197, 0.15);
    }

    .form-group.invalid .calc-form input {
        border-color: var(--danger-color);
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
    }
    
    .error-message {
        color: var(--danger-color);
        font-size: 13px;
        font-weight: 500;
        display: none;
        margin-top: 2px;
    }
    
    .calc-form button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      height: 48px;
      padding: 14px;
      font-size: 16px;
      font-weight: 600;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }
    
    .calc-form button:hover:not(:disabled) {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 122, 155, 0.2);
    }
    
    .calc-form button:disabled {
        cursor: not-allowed;
        background-color: #a0a0a0;
    }

    .calc-form button .spinner {
        width: 18px;
        height: 18px;
        border: 2px solid rgba(255, 255, 255, 0.5);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        display: none;
    }
    
    .resultados {
      display: none;
      margin-top: 20px;
      padding: 1.5rem;
      background: var(--bg-result);
      border-left: 4px solid var(--primary-color);
      border-radius: 8px;
      font-size: 15px;
      color: var(--text-color);
    }
    
    .resultados.mostrar {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    .resultado-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
    }

    .resultado-item + .resultado-item {
        border-top: 1px solid #e0f0f8;
    }

    .resultado-item p {
        font-weight: 500;
        color: var(--text-light);
    }

    .valor {
      font-size: 22px;
      font-weight: 700;
      color: var(--text-color);
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
  </style>
</head>
<body>
  <div class="calc-wrapper">
    <form id="calc-form" class="calc-form" novalidate>
      
      <div class="form-group" data-field="email">
        <label for="email">Seu melhor e-mail</label>
        <div class="input-wrapper">
            <span class="input-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
            </span>
            <input type="email" id="email" placeholder="Ex: seu.nome@email.com" required>
            <span class="validation-icon success-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#28a745" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </span>
        </div>
        <span class="error-message">Por favor, insira um e-mail válido.</span>
      </div>
      
      <div class="form-group" data-field="valor">
        <label for="valor">Total da Operação (R$)</label>
        <div class="input-wrapper">
            <span class="input-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
            </span>
            <input type="text" id="valor" placeholder="R$ 0,00" required>
             <span class="validation-icon success-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#28a745" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </span>
        </div>
        <span class="error-message">O valor deve ser maior que zero.</span>
      </div>
      
      <div class="form-group" data-field="prazo">
        <label for="prazo">Prazo (dias)</label>
        <div class="input-wrapper">
            <span class="input-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            </span>
            <input type="number" id="prazo" placeholder="Ex: 30" required>
            <span class="validation-icon success-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#28a745" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </span>
        </div>
        <span class="error-message">O prazo deve ser maior que zero.</span>
      </div>
      
      <div class="form-group" data-field="taxa">
        <label for="taxa">Taxa (% a.m.)</label>
        <div class="input-wrapper">
             <span class="input-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="5" x2="5" y2="19"></line><circle cx="6.5" cy="6.5" r="2.5"></circle><circle cx="17.5" cy="17.5" r="2.5"></circle></svg>
            </span>
            <input type="text" id="taxa" placeholder="Ex: 3,50" required>
            <span class="validation-icon success-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#28a745" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </span>
        </div>
         <span class="error-message">A taxa deve ser maior que zero.</span>
      </div>
      
      <div class="form-group" data-field="clientes">
        <label for="num-clientes">Nº de clientes na carteira</label>
         <div class="input-wrapper">
            <span class="input-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            </span>
            <input type="number" id="num-clientes" placeholder="Ex: 5" required>
            <span class="validation-icon success-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#28a745" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </span>
        </div>
        <span class="error-message">O nº de clientes deve ser maior que zero.</span>
      </div>
      
      <button type="button" id="btn-simulacao">
        <span class="btn-text">Fazer Simulação</span>
        <span class="spinner"></span>
         <span class="btn-icon"></span>
      </button>
      
      <div class="resultados" id="resultado-box">
        <div class="resultado-item">
            <p>Sua comissão recorrente será:</p>
            <span id="comissao" class="valor">R$ 0,00</span>
        </div>
        <div class="resultado-item">
            <p>Seu bônus de ativação será:</p>
            <span id="bonus" class="valor">R$ 0,00</span>
        </div>
      </div>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('calc-form');
        const allInputs = form.querySelectorAll('input'); // Alterado para não buscar mais o 'select'
        const btn = document.getElementById('btn-simulacao');
        const btnText = btn.querySelector('.btn-text');
        const spinner = btn.querySelector('.spinner');

        // --- FUNÇÕES DE FORMATAÇÃO ---
        const formatBRL = (value) => value.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
        const parseBRL = (str) => {
            if (!str) return 0;
            const cleaned = str.replace(/[^0-9,]/g, '').replace(',', '.');
            return parseFloat(cleaned) || 0;
        };

        const applyInputFormatting = (input, formatter) => {
            let lastValue = input.value;
            input.addEventListener('input', () => {
                formatter(input);
                if (input.value !== lastValue) {
                    lastValue = input.value;
                    validateField(input);
                }
            });
        };

        const formatCurrencyInput = (input) => {
            let raw = input.value.replace(/\D/g, '');
            input.value = !raw ? '' : `R$ ${(parseInt(raw, 10) / 100).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        };

        const formatRateInput = (input) => {
            let raw = input.value.replace(/\D/g, '');
            input.value = !raw ? '' : (parseInt(raw, 10) / 100).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };
        
        applyInputFormatting(document.getElementById('valor'), formatCurrencyInput);
        applyInputFormatting(document.getElementById('taxa'), formatRateInput);

        // --- FUNÇÕES DE VALIDAÇÃO ---
        const validationRules = {
            email: (el) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(el.value),
            valor: (el) => parseBRL(el.value) > 0,
            prazo: (el) => parseInt(el.value) > 0,
            taxa: (el) => parseBRL(el.value) > 0,
            clientes: (el) => parseInt(el.value) > 0,
        };

        const validateField = (field) => {
            const group = field.closest('.form-group');
            const fieldName = group.dataset.field;
            const isValid = validationRules[fieldName] ? validationRules[fieldName](field) : field.value.trim() !== '';

            group.classList.toggle('invalid', !isValid);
            group.classList.toggle('valid', isValid);
            group.querySelector('.error-message').style.display = isValid ? 'none' : 'block';
            return isValid;
        };
        
        const validateForm = () => {
            let isFormValid = true;
            allInputs.forEach(input => {
                if (!validateField(input)) {
                    isFormValid = false;
                }
            });
            return isFormValid;
        };

        allInputs.forEach(input => {
            input.addEventListener('blur', () => validateField(input));
            input.addEventListener('input', () => {
                if (input.closest('.form-group').classList.contains('invalid')) {
                    validateField(input);
                }
            });
        });


        // --- CONTROLE DO BOTÃO ---
        const setButtonState = (state, text = 'Fazer Simulação') => {
            btn.disabled = (state === 'loading');
            spinner.style.display = (state === 'loading') ? 'block' : 'none';
            btn.querySelector('.btn-icon').innerHTML = '';
            
            if (state === 'loading') {
                btnText.textContent = 'Calculando...';
            } else if (state === 'success') {
                btn.disabled = true;
                btnText.textContent = 'Sucesso!';
                btn.querySelector('.btn-icon').innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';
                setTimeout(() => {
                    btn.disabled = false;
                    setButtonState('default', text);
                }, 2000);
            } else {
                 btnText.textContent = text;
            }
        };

        // --- FUNÇÕES DE CÁLCULO E LÓGICA PRINCIPAL ---
        const performCalculation = () => {
            if (!validateForm()) {
                const firstInvalid = form.querySelector('.form-group.invalid');
                if(firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            };

            setButtonState('loading');

            const email = document.getElementById('email').value;
            const valor = parseBRL(document.getElementById('valor').value);
            const prazo = parseFloat(document.getElementById('prazo').value);
            const taxa = parseBRL(document.getElementById('taxa').value) / 100;
            const numClientes = parseInt(document.getElementById('num-clientes').value);
            
            // ALTERADO: Nível de parceria fixado em 10% (0.1)
            const nivel = 0.1; 

            const desagio = valor * (Math.pow(1 + taxa, prazo / 30) - 1);
            const comissao = desagio * nivel;
            const bonusAtivacao = numClientes * 1500;

            document.getElementById('comissao').textContent = formatBRL(comissao);
            document.getElementById('bonus').textContent = formatBRL(bonusAtivacao);
            
            const resultadoBox = document.getElementById('resultado-box');
            resultadoBox.classList.add('mostrar');
            
            setTimeout(() => {
                resultadoBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                updateFrameHeight();
            }, 300);

            sendToWebhook({ email, valor, prazo, taxa, comissao, numClientes, bonusAtivacao });
            
            setButtonState('success');
        };
        
        btn.addEventListener('click', performCalculation);
        
        // --- FUNÇÕES AUXILIARES ---
        const updateFrameHeight = () => {
            if (window.parent !== window) {
                window.parent.postMessage({ height: document.documentElement.scrollHeight }, "*");
            }
        };
        window.addEventListener("load", updateFrameHeight);
        window.addEventListener("resize", updateFrameHeight);

        const sendToWebhook = (data) => {
            fetch("https://hook.us1.make.com/mqae7omxgmno4jto0vlzuunaekqrsxji", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    email: data.email,
                    valor_operacao: formatBRL(data.valor),
                    prazo_dias: data.prazo,
                    taxa_am: `${(data.taxa * 100).toLocaleString("pt-BR", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}% a.m.`,
                    comissao_recorrente: formatBRL(data.comissao),
                    num_clientes: data.numClientes,
                    bonus_ativacao: formatBRL(data.bonusAtivacao)
                })
            }).then(() => console.log("Webhook enviado com sucesso."))
              .catch(err => console.error("Erro ao enviar webhook:", err));
        };
    });
  </script>
</body>
</html>
